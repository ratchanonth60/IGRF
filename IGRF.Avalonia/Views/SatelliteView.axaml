<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:sp="clr-namespace:ScottPlot.Avalonia;assembly=ScottPlot.Avalonia"
             xmlns:vm="using:IGRF.Avalonia.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="IGRF.Avalonia.Views.SatelliteView"
             x:DataType="vm:MainViewModel">
    
    <Grid RowDefinitions="Auto, *" ColumnDefinitions="*, 300">
        <!-- Controls (Top Bar) -->
        <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="10" Margin="10">
            <ComboBox ItemsSource="{Binding SatelliteList}" SelectedItem="{Binding SelectedSatellite}" Width="200"/>
            <TextBlock Text="{Binding SatLat, StringFormat='Lat: {0:F4}'}" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding SatLon, StringFormat='Lon: {0:F4}'}" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding SatAlt, StringFormat='Alt: {0:F2} km'}" VerticalAlignment="Center"/>
            <Button Content="ðŸ—ºï¸ Load Map Data" Command="{Binding LoadMapDataCommand}" Margin="20,0,0,0" Background="#2A5A8A"/>
            <TextBlock Text="{Binding MapLoadStatus}" VerticalAlignment="Center" Foreground="#AAAAAA" FontSize="12"/>
        </StackPanel>
        
        <!-- Map with Custom Contours -->
        <sp:AvaPlot Name="MapPlot" Grid.Row="1" Grid.Column="0"/>

        <!-- Manual Calculator Sidebar -->
        <Border Grid.Column="1" Grid.RowSpan="2" Background="#252525" Margin="5" CornerRadius="8" Padding="10">
             <ScrollViewer>
                 <StackPanel Spacing="8">
                     <TextBlock Text="Satellite Result" FontWeight="Bold" FontSize="14" Foreground="Cyan" HorizontalAlignment="Center"/>
                     <TextBox Text="{Binding SatelliteCalculationResult}" 
                              IsReadOnly="True" Height="80"
                              FontFamily="Consolas, Monospace" 
                              Background="#151515" Foreground="Cyan"/>

                     <Separator Background="#444444" Height="2" Margin="0,10"/>
                     
                     <TextBlock Text="Manual Calculation" FontWeight="Bold" FontSize="14" Foreground="White" HorizontalAlignment="Center"/>
                     
                     <TextBlock Text="Latitude:" Foreground="#AAAAAA"/>
                     <TextBox Text="{Binding ManualLat}" Height="28"/>
                    
                     <TextBlock Text="Longitude:" Foreground="#AAAAAA"/>
                     <TextBox Text="{Binding ManualLon}" Height="28"/>
                     
                     <Button Content="Calculate" 
                             Command="{Binding CalculateGeoMagneticCommand}"
                             HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"/>
                     
                     <TextBlock Text="Manual Result:" FontWeight="Bold" Foreground="White" Margin="0,10,0,0"/>
                     <TextBox Text="{Binding CalculationResult}" 
                              AcceptsReturn="True" TextWrapping="Wrap" 
                              IsReadOnly="True" Height="80"
                              FontFamily="Consolas, Monospace"/>
                     
                     <Separator Background="#444444" Height="2" Margin="0,15"/>
                     
                     <!-- Simulation / Time Speed -->
                     <TextBlock Text="Simulation" FontWeight="Bold" FontSize="14" Foreground="#FFA500" HorizontalAlignment="Center"/>
                     <StackPanel Margin="0,8,0,0">
                         <Grid ColumnDefinitions="*, Auto">
                             <TextBlock Text="Time Speed" VerticalAlignment="Center" Foreground="#AAAAAA" FontSize="12"/>
                             <TextBlock Text="{Binding TimeSpeed, StringFormat='{}{0:F0}x'}" Grid.Column="1" Foreground="#00BFFF" FontSize="12" FontWeight="Bold"/>
                         </Grid>
                         <Slider Value="{Binding TimeSpeed}" Minimum="0" Maximum="1000" LargeChange="100" Margin="0,5"/>
                     </StackPanel>
                     
                     <Separator Background="#444444" Height="2" Margin="0,15"/>
                     
                     <!-- TLE Management -->
                     <TextBlock Text="ðŸ›°ï¸ TLE Management" FontWeight="Bold" FontSize="14" Foreground="#4A9EFF" HorizontalAlignment="Center"/>
                     
                     <!-- Space-Track.org Login -->
                     <StackPanel Margin="0,8,0,0" Spacing="4">
                         <TextBlock Text="Space-Track.org:" Foreground="#AAAAAA" FontSize="11"/>
                         <TextBox Text="{Binding SpaceTrackUsername}" Watermark="Username (email)" FontSize="10" Height="24"/>
                         <TextBox Text="{Binding SpaceTrackPassword}" Watermark="Password" PasswordChar="â—" FontSize="10" Height="24"/>
                         <Grid ColumnDefinitions="*, Auto" ColumnSpacing="5">
                             <TextBox Grid.Column="0" Text="{Binding SatelliteNoradId}" Watermark="NORAD ID (e.g., 25544)"
                                      FontFamily="Consolas" FontSize="11" Height="26"/>
                             <Button Grid.Column="1" Content="Fetch" Command="{Binding FetchTleFromSpaceTrackCommand}"
                                     Background="#2A5A8A" MinWidth="50" FontSize="11"/>
                         </Grid>
                         <TextBlock Text="{Binding TleFetchStatus}" Foreground="#888888" FontSize="10" TextWrapping="Wrap"/>
                     </StackPanel>
                     
                     <Separator Background="#333333" Height="1" Margin="0,10"/>
                     
                     <!-- Manual TLE Input -->
                     <TextBlock Text="Manual TLE Input:" Foreground="#AAAAAA" FontSize="11"/>
                     <StackPanel Spacing="4">
                         <TextBox Text="{Binding ManualTleName}" Watermark="Satellite Name" FontSize="11" Height="26"/>
                         <TextBox Text="{Binding ManualTleLine1}" Watermark="TLE Line 1" FontFamily="Consolas" FontSize="10" Height="26"/>
                         <TextBox Text="{Binding ManualTleLine2}" Watermark="TLE Line 2" FontFamily="Consolas" FontSize="10" Height="26"/>
                         <Button Content="Add Satellite" Command="{Binding AddManualSatelliteCommand}"
                                 Background="#2A4A2A" Foreground="#88FF88" HorizontalAlignment="Stretch" FontSize="11"/>
                     </StackPanel>
                 </StackPanel>
             </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
